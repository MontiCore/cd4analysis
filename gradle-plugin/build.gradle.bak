/* (c) https://github.com/MontiCore/monticore */
plugins {
  id "groovy"
  id "java-gradle-plugin"
  id 'maven-publish'
}

dependencies {
  implementation gradleApi()
  implementation localGroovy()
  implementation "de.monticore.lang:cd4analysis:${version}:cli"
  /*implementation (group: 'de.monticore', name: 'monticore-cli', version: "$version"){
    exclude group: 'de.monticore', module: 'monticore-grammar'
  }
  implementation (group: 'de.monticore', name: 'monticore-generator', version: "$version"){
    exclude group: 'de.monticore', module: 'monticore-grammar'
  }
  implementation (group: 'de.monticore', name: 'monticore-grammar', version: "6.4.0"){
    force = true
  }*/
}

gradlePlugin.plugins {
  monticore {
    id = 'monticore'
    implementationClass = 'de.monticore.CDPlugin'
  }
}

task sourcesJar(type: Jar, dependsOn: classes) {
  archiveClassifier = 'sources'
  from sourceSets.main.allSource
}

// configure deployment
publishing {
  // configure what artifacts to publish
  publications {
    pluginMaven(MavenPublication) {
      artifact sourcesJar
    }
  }
  repositories.maven {
    credentials.username mavenUser
    credentials.password mavenPassword
    def releasesRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/monticore-releases/"
    def snapshotsRepoUrl = "https://nexus.se.rwth-aachen.de/content/repositories/monticore-snapshots/"
    url = version.endsWith('SNAPSHOT') ? snapshotsRepoUrl : releasesRepoUrl
  }
}
